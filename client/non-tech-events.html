<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Non-Tech Events | Mayukh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white font-sans overflow-x-hidden">

    <main class="md:ml-64 min-h-screen p-6">
        <header class="mb-12 mt-12 md:mt-0 text-center md:text-left">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-2">NON-TECH EVENTS</h1>
            <p class="text-gray-400">Unleash your creativity beyond code.</p>
        </header>

        <div class="mb-8 relative max-w-md">
            <input type="text" id="searchInput" placeholder="Search events..." 
                   class="w-full bg-gray-800/50 border border-gray-700 rounded-full py-3 px-6 pl-12 text-white focus:border-purple-500 focus:outline-none transition">
            <i class="fa-solid fa-search absolute left-4 top-3.5 text-gray-500"></i>
        </div>

        <div id="skeletonLoader" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="h-96 bg-gray-800/50 rounded-2xl animate-pulse"></div>
            <div class="h-96 bg-gray-800/50 rounded-2xl animate-pulse"></div>
            <div class="h-96 bg-gray-800/50 rounded-2xl animate-pulse"></div>
        </div>

        <div id="eventsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
            </div>
    </main>

    <script src="api-config.js"></script>
    <script>
        const CATEGORY_FILTER = "non-tech-event";
        
        let allEvents = [];
        const container = document.getElementById('eventsContainer');
        const loader = document.getElementById('skeletonLoader');

        async function loadData() {
            try {
                const cached = localStorage.getItem('mayukh_events_cache');
                const cacheTime = localStorage.getItem('mayukh_events_time');
                const now = new Date().getTime();

                if (cached && cacheTime && (now - cacheTime < 300000)) {
                    allEvents = JSON.parse(cached);
                    renderEvents(allEvents);
                }

                const res = await fetch(`${API_BASE_URL}/api/events`);
                if (!res.ok) throw new Error('API Failed');
                
                const data = await res.json();
                allEvents = (data.events || data).filter(e => e.eventType === CATEGORY_FILTER);
                
                localStorage.setItem('mayukh_events_cache', JSON.stringify(allEvents));
                localStorage.setItem('mayukh_events_time', now);

                renderEvents(allEvents);

            } catch (err) {
                console.error(err);
                showToast("Failed to load events", "error");
            } finally {
                loader.classList.add('hidden');
                container.classList.remove('hidden');
            }
        }

        function renderEvents(events) {
            if (events.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center text-gray-500 py-10">No events found.</div>`;
                return;
            }

            container.innerHTML = events.map(e => `
                <div class="bg-gray-800/40 border border-gray-700 rounded-2xl overflow-hidden hover:border-purple-500/50 transition-all group hover:-translate-y-1">
                    <div class="h-48 overflow-hidden relative">
                        <img src="${e.posterLink}" 
                             alt="${e.title}" 
                             loading="lazy"
                             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                             onerror="this.src='https://via.placeholder.com/400?text=Event'">
                        <div class="absolute top-2 right-2 bg-black/60 backdrop-blur px-2 py-1 rounded text-xs font-bold text-[#66fcf1]">
                            ${e.category}
                        </div>
                    </div>
                    <div class="p-5">
                        <h3 class="text-xl font-bold text-white mb-2 line-clamp-1">${e.title}</h3>
                        <p class="text-gray-400 text-sm mb-4 line-clamp-2">${e.description}</p>
                        <div class="flex justify-between items-center mt-4">
                            <span class="text-xs text-purple-400"><i class="fa-regular fa-calendar mr-1"></i> ${e.date || 'TBA'}</span>
                            <a href="${e.registrationLink}" target="_blank" class="bg-purple-600 hover:bg-purple-500 text-white text-sm font-bold px-4 py-2 rounded-full transition">REGISTER</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        let debounceTimer;
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const query = e.target.value.toLowerCase();
                const filtered = allEvents.filter(ev => ev.title.toLowerCase().includes(query));
                renderEvents(filtered);
            }, 300);
        });

        function showToast(msg, type) {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-5 right-5 px-6 py-3 rounded shadow-lg text-white font-bold z-50 ${type === 'error' ? 'bg-red-600' : 'bg-green-600'} animate-bounce`;
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        loadData();
    </script>
</body>
</html>
